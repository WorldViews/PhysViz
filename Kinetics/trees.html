<html>
<head>
    <title>Playing with trees and mobiles</title>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="js/three.js"></script>
<script src="js/controls/TrackballControls.js"></script>
<script src="js/Detector.js"></script>
<script src="js/libs/stats.min.js"></script>

<div id="controls">
   Params: <input id="showParams" type="checkbox">
   &nbsp;
   <input id="reset" type="button" value="reset">
   <div id="params" hidden>
   </div>
</div>

<script src="trees.js"></script>
<script>
setupWorld();
</script>
<script src="GetWebSock.js"></script>
<script>
//WS = GetWebSock({'orientation': handleOrientation } );
WS = GetWebSock({'motion': handleMotion } );

var prev_a = null;
var angle = 0;

function setHeading(angle)
{
    report("setHeading "+angle);
    P.root.rotation.y = - angle * Math.PI / 180.0;
}

function handleOrientation(msg) {
   report("msg: "+JSON.stringify(msg));
   var a = msg.yaw;
   var da = 0;
   if (prev_a == null) {
      prev_a = a;
   }
   else {
      da = a - prev_a;
      prev_a = a;
      if (da > 180)
         da -= 360;
      if (da < -180)
         da += 360;
   }
   angle += da;
   report("angle: "+angle);
   CRANK_ANGLE = angle;
   setHeading(angle);
}


function handleMotion(msg) {
   report("msg: "+JSON.stringify(msg));
   var rrate = msg.rotationRate;
   var idx = 2;
   var omega = rrate[idx];
   prev_motion_t = null;
   //var da = 360*omega/(2*Math.PI);
   var da = omega;
   angle += da;
   report("angle: "+angle);
   CRANK_ANGLE = angle;
   setHeading(angle);
}

</script>
</body>
</html>
